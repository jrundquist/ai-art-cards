<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AICardArts</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- CSS Variables and Base -->
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/animations.css" />
    <!-- Animations used by base/components -->
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/cards.css" />
    <link rel="stylesheet" href="css/chat.css" />
    <link rel="stylesheet" href="css/modals.css" />
    <link rel="stylesheet" href="css/image-details.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com; img-src 'self' data: blob: file: https:;"
    />
  </head>
  <body>
    <!-- Ambient Background Effects -->
    <!-- Ambient Background Effects -->
    <div
      aria-hidden="true"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      "
    >
      <div
        style="
          position: absolute;
          top: -10%;
          right: -5%;
          width: 50%;
          height: 50%;
          background: radial-gradient(
            circle,
            rgba(16, 185, 129, 0.08) 0%,
            transparent 70%
          );
          border-radius: 50%;
          filter: blur(50px);
        "
      ></div>
      <div
        style="
          position: absolute;
          bottom: -10%;
          left: -10%;
          width: 50%;
          height: 50%;
          background: radial-gradient(
            circle,
            rgba(139, 92, 246, 0.08) 0%,
            transparent 70%
          );
          border-radius: 50%;
          filter: blur(50px);
        "
      ></div>
    </div>
    <div class="app-container">
      <!-- Global App Header -->
      <header class="app-header">
        <div class="header-left">
          <h1 id="appTitle">AI Card Arts <span id="projectName"></span></h1>
        </div>
        <div class="header-right actions key-manager">
          <div id="keySelectWrapper" class="key-select-wrapper">
            <select id="keySelect" aria-label="Select API Key">
              <option value="">Select API Key...</option>
            </select>
          </div>
          <button
            id="addKeyToggleBtn"
            class="icon-btn"
            title="Add New Key"
            aria-label="Add New API Key"
            aria-haspopup="dialog"
          >
            <span class="material-icons">add</span>
          </button>

          <div class="divider-vertical"></div>

          <button
            id="chatToggleBtn"
            class="chat-toggle-btn glow-effect"
            title="Open AI Chat"
          >
            <span class="material-icons">chat_bubble_outline</span>
          </button>

          <!-- Hidden old input compatibility if needed, or just removed -->
          <input type="hidden" id="apiKeyInput" />
        </div>
      </header>

      <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
          <div class="sidebar-header-projects">
            <div class="project-select-wrapper">
              <select id="projectSelect">
                <option value="">Select Project...</option>
              </select>
              <button
                id="openFolderBtn"
                class="icon-btn hidden"
                title="Open Data Folder"
                aria-label="Open Data Folder"
              >
                <span class="material-icons">folder_open</span>
              </button>
              <button
                id="editProjectBtn"
                class="icon-btn"
                title="Project Settings"
                aria-label="Project Settings"
              >
                <span class="material-icons">settings</span>
              </button>
              <button
                id="newProjectBtn"
                class="icon-btn"
                title="New Project"
                aria-label="Create New Project"
              >
                <span class="material-icons">add</span>
              </button>
            </div>
          </div>

          <div class="sidebar-search-wrapper">
            <div style="position: relative; flex: 1">
              <input
                type="text"
                id="cardSearchInput"
                placeholder="Search cards..."
                aria-label="Search cards"
              />
            </div>
            <div class="sort-dropdown-wrapper">
              <button
                id="sortBtn"
                class="icon-btn"
                title="Sort Cards"
                aria-label="Sort Cards"
              >
                <span class="material-icons">sort</span>
              </button>
              <div id="sortMenu" class="dropdown-menu hidden">
                <button class="dropdown-item active" data-sort="default">
                  <span class="material-icons">calendar_today</span> Creation
                  (Default)
                </button>
                <button class="dropdown-item" data-sort="name">
                  <span class="material-icons">sort_by_alpha</span> Name (A-Z)
                </button>
                <button class="dropdown-item" data-sort="count">
                  <span class="material-icons">filter_9_plus</span> Image Count
                </button>
              </div>
            </div>
            <button
              id="newCardBtnSmall"
              class="primary-btn full-width"
              title="New Card"
              style="margin-left: 8px; padding: 4px"
              aria-label="New Card"
            >
              <span class="material-icons">add</span>
            </button>
          </div>

          <div id="cardList" class="card-list">
            <!-- Cards injected here -->
          </div>

          <button id="newCardBtn" class="primary-btn full-width">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 8px"
              >add</span
            >New Card
          </button>

          <!-- Resize Handle -->
          <div class="resize-handle" id="sidebarResizeHandle"></div>
        </aside>

        <!-- Chat Sidebar moved to right -->

        <!-- Main Content -->
        <main class="main-content">
          <div class="content-scroll-wrapper">
            <header class="top-bar">
              <div class="title-wrapper">
                <h2 id="currentCardTitle" title="Click to edit">
                  Select a Card
                </h2>
                <input
                  type="text"
                  id="cardTitleInput"
                  class="title-input hidden"
                  aria-label="Card Title"
                />
                <button
                  id="editTitleBtn"
                  class="icon-btn-ghost"
                  title="Rename Card"
                  aria-label="Rename Card"
                >
                  <span class="material-icons">edit</span>
                </button>
              </div>
              <!-- Actions moved to global header -->
            </header>

            <!-- Project Selection View -->
            <div
              id="projectSelectionView"
              class="project-selection-view hidden"
            >
              <div class="project-selection-header">
                <h2>Choose a Project</h2>
                <button id="projectSelectionCreateBtn" class="primary-btn">
                  <span
                    class="material-icons"
                    style="font-size: 18px; margin-right: 8px"
                    >add</span
                  >Create Project
                </button>
              </div>
              <div id="projectGridContainer" class="project-grid">
                <!-- Project cards will be inserted here -->
              </div>
            </div>

            <div id="editorArea" class="editor-area hidden">
              <div class="form-grid">
                <!-- Hidden fields -->
                <input type="hidden" id="cardNameInput" />

                <div class="form-group full-width">
                  <label>Prompt</label>
                  <textarea
                    id="promptInput"
                    rows="4"
                    placeholder="Describe the image..."
                  ></textarea>
                </div>

                <div
                  class="form-group full-width"
                  id="modifierToggleRow"
                  style="display: none"
                >
                  <label>Active Modifiers</label>
                  <div id="modifierToggles" class="modifier-toggles">
                    <!-- Checkboxes injected here -->
                  </div>
                </div>

                <div class="combined-row full-width">
                  <div class="form-group">
                    <label>Output Subfolder</label>
                    <div style="display: flex; gap: 8px">
                      <input
                        type="text"
                        id="subfolderInput"
                        placeholder="default"
                        style="flex: 1"
                      />
                      <button
                        id="openCardFolderBtn"
                        class="secondary-btn icon-btn hidden"
                        title="Open Card Folder"
                        aria-label="Open Card Folder"
                        style="height: 38px; width: 38px"
                      >
                        <span class="material-icons">folder_open</span>
                      </button>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Aspect Ratio</label>
                    <select id="cardAspectRatio">
                      <option value="">Default</option>
                      <option value="Auto">Auto</option>
                      <option value="1:1">1:1</option>
                      <option value="16:9">16:9</option>
                      <option value="9:16">9:16</option>
                      <option value="3:4">3:4</option>
                      <option value="4:3">4:3</option>
                      <option value="3:2">3:2</option>
                      <option value="2:3">2:3</option>
                      <option value="5:4">5:4</option>
                      <option value="4:5">4:5</option>
                      <option value="21:9">21:9</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Resolution</label>
                    <select id="cardResolution">
                      <option value="">Default</option>
                      <option value="1K">1K</option>
                      <option value="2K">2K</option>
                      <option value="4K">4K</option>
                    </select>
                  </div>
                </div>

                <div
                  class="form-group full-width"
                  style="align-items: flex-end"
                >
                  <button id="saveCardBtn" class="secondary-btn">
                    Save Card
                  </button>
                </div>
              </div>

              <div class="generation-controls">
                <div class="generate-group glow">
                  <button id="generateBtn" class="generate-group-btn">
                    Generate Art
                    <span
                      class="material-icons"
                      style="
                        font-size: 1.2em;
                        vertical-align: middle;
                        margin-left: 4px;
                      "
                      >auto_awesome</span
                    >
                  </button>
                  <div
                    class="generate-group-picker"
                    title="Number of images to generate"
                  >
                    <input
                      type="number"
                      id="genCount"
                      value="1"
                      min="1"
                      max="10"
                    />
                  </div>
                </div>
                <button
                  id="galleryFilterFavorites"
                  class="secondary-btn icon-btn"
                  title="Show Favorites Only"
                  aria-label="Show Favorites Only"
                  style="margin-left: auto"
                  aria-pressed="false"
                >
                  <span class="material-icons">favorite_border</span>
                </button>
                <button
                  id="galleryFilterArchive"
                  class="secondary-btn icon-btn"
                  title="Show Archived (Trash)"
                  aria-label="Show Archived Images"
                  style="margin-left: 5px"
                  aria-pressed="false"
                >
                  <span class="material-icons">delete_outline</span>
                </button>
                <button
                  id="galleryDownloadBtn"
                  class="secondary-btn icon-btn"
                  title="Download Displayed Images"
                  aria-label="Download Displayed Images as Zip"
                  style="margin-left: 5px"
                >
                  <span class="material-icons">download</span>
                </button>
              </div>

              <div id="gallery" class="gallery-grid">
                <!-- Images go here -->
              </div>
            </div>
          </div>
        </main>

        <!-- Chat Sidebar -->
        <aside id="chatSidebar" class="chat-sidebar hidden">
          <div class="chat-resize-handle" id="chatResizeHandle"></div>
          <div class="chat-header">
            <h3>AI Assistant</h3>
            <button
              id="chatHistoryBtn"
              class="icon-btn-sm"
              title="Chat History"
            >
              <span class="material-icons">history</span>
            </button>
            <button id="newChatBtn" class="icon-btn-sm" title="New Chat">
              <span class="material-icons">add_comment</span>
            </button>
            <button
              id="closeChatBtn"
              class="icon-btn-sm close-chat-btn"
              title="Close Chat"
            >
              <span class="material-icons">close</span>
            </button>
          </div>
          <div id="chatMessages" class="chat-messages">
            <!-- Messages go here -->
            <div class="chat-welcome">
              <p>
                Hello! I can help you manage your cards and generate art. Try
                asking:
              </p>
              <ul>
                <li>"Create a card for a Cyberpunk City"</li>
                <li>"List my cards"</li>
                <li>"Generate images for the Dragon card"</li>
              </ul>
            </div>
          </div>
          <div class="chat-input-area" id="chatInputArea">
            <div class="chat-input-wrapper">
              <div
                id="chatImagePreviews"
                class="chat-image-previews hidden"
              ></div>
              <textarea
                id="chatInput"
                placeholder="Type a message..."
                rows="1"
              ></textarea>
              <div class="chat-input-footer">
                <div class="chat-input-footer-left">
                  <input
                    type="file"
                    id="chatFileInput"
                    multiple
                    accept="image/*"
                    class="hidden"
                  />
                  <button
                    id="chatUploadBtn"
                    class="icon-btn-sm secondary"
                    title="Upload Images"
                  >
                    <span class="material-icons">add_photo_alternate</span>
                  </button>
                  <button
                    id="thinkingToggleBtn"
                    class="icon-btn-sm secondary"
                    title="Thinking Mode (Off)"
                    aria-pressed="false"
                  >
                    <span class="material-icons">psychology</span>
                  </button>
                </div>
                <div class="chat-input-footer-right">
                  <button id="sendChatBtn" class="primary-btn-sm">
                    <span class="material-icons">send</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
      <!-- End main-layout -->

      <footer id="statusBar">
        <div class="status-left" id="statusMessage">Ready</div>
        <div class="status-center" id="statusCenter"></div>
        <div class="status-right">
          <span>v1.1.1</span>
          <select
            id="themeSelect"
            class="theme-select"
            aria-label="Theme Selection"
            style="
              margin-left: 10px;
              padding: 2px 6px;
              font-size: 0.8rem;
              background: transparent;
              color: var(--text-muted);
              border: 1px solid var(--border);
              border-radius: 4px;
            "
          >
            <option value="system">System</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
          <button
            id="helpBtn"
            class="status-help-btn"
            title="Help & Shortcuts (?)"
            aria-label="Help and Shortcuts"
          >
            ?
          </button>
        </div>
      </footer>
    </div>

    <!-- Project Modal -->
    <div
      id="projectModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="projectModalTitle"
    >
      <div class="modal-content modal-content-project">
        <h3>Project Settings</h3>
        <div class="two-col-grid">
          <!-- Left Column: Basic Info -->
          <div class="modal-col-left">
            <input type="hidden" id="newProjectId" />
            <div
              style="
                display: none;
                margin-bottom: 15px;
                margin-top: -5px;
                font-size: 0.5em;
                color: var(--text-muted);
              "
            >
              ID: <span id="newProjectIdDisplay"></span>
            </div>

            <div class="form-group">
              <label for="newProjectName">Project Name</label>
              <input
                type="text"
                id="newProjectName"
                placeholder="My Awesome Project"
                style="font-size: 1.1em; font-weight: bold"
              />
            </div>

            <div class="form-group">
              <label for="newProjectDescription">Description</label>
              <textarea
                id="newProjectDescription"
                placeholder="Optional description..."
                style="height: 80px"
              ></textarea>
            </div>

            <div class="form-group">
              <label for="newProjectRoot">Output Folder Name</label>
              <input
                type="text"
                id="newProjectRoot"
                placeholder="e.g. tarot_deck"
                aria-label="Output Directory"
              />
              <div
                style="
                  font-size: 0.75em;
                  color: var(--text-muted);
                  margin-top: 4px;
                "
              >
                Folder where images will be saved.
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label>Default Aspect Ratio</label>
                <select id="newAspectRatio">
                  <option value="">Auto (Unspecified)</option>
                  <option value="16:9">16:9</option>
                  <option value="9:16">9:16</option>
                  <option value="3:4">3:4</option>
                  <option value="4:3">4:3</option>
                  <option value="3:2">3:2</option>
                  <option value="2:3" selected>2:3</option>
                  <option value="5:4">5:4</option>
                  <option value="4:5">4:5</option>
                  <option value="21:9">21:9</option>
                </select>
              </div>
              <div class="form-group">
                <label>Resolution</label>
                <select id="newResolution">
                  <option value="1K">1K</option>
                  <option value="2K" selected>2K</option>
                  <option value="4K">4K</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Right Column: Modifiers & Settings -->
          <div class="modal-col-right">
            <div
              class="form-group"
              style="flex: 1; display: flex; flex-direction: column"
            >
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  margin-bottom: 5px;
                "
              >
                <label style="margin-bottom: 0">Prompt Modifiers</label>
                <span
                  class="material-icons help-icon"
                  style="
                    font-size: 16px;
                    color: var(--text-muted);
                    cursor: help;
                  "
                  title="Prefixes are added to the start of the prompt. Suffixes are added to the end. You can toggle specific modifiers off for individual cards."
                  >help_outline</span
                >
              </div>

              <div
                class="modifier-lists-container"
                style="flex: 1; overflow-y: auto; max-height: 250px"
              >
                <div class="modifier-section">
                  <label class="sub-label">Prefixes</label>
                  <div id="prefixList" class="modifier-list prompt-list">
                    <!-- Prefixes injected here -->
                  </div>
                </div>
                <div class="modifier-section" style="margin-top: 10px">
                  <label class="sub-label">Suffixes</label>
                  <div id="suffixList" class="modifier-list prompt-list">
                    <!-- Suffixes injected here -->
                  </div>
                </div>
              </div>

              <div class="modifier-add-container">
                <label class="sub-label">New Modifier</label>
                <div class="modifier-add-row-top">
                  <input
                    type="text"
                    id="newModName"
                    placeholder="Name (e.g. Style)"
                    style="flex: 1"
                  />
                </div>
                <textarea
                  id="newModText"
                  class="modifier-add-textarea"
                  placeholder="Prompt Modifier Text..."
                  rows="2"
                ></textarea>
                <div
                  style="
                    display: flex;
                    justify-content: flex-end;
                    gap: 8px;
                    margin-top: 5px;
                  "
                >
                  <button
                    id="addPrefixBtn"
                    class="secondary-btn"
                    style="padding: 6px 12px; font-size: 0.85em"
                    title="Add as Prefix"
                  >
                    + Prefix
                  </button>
                  <button
                    id="addSuffixBtn"
                    class="secondary-btn"
                    style="padding: 6px 12px; font-size: 0.85em"
                    title="Add as Suffix"
                  >
                    + Suffix
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button
            id="exportProjectBtn"
            class="secondary-btn"
            style="margin-right: auto"
          >
            Export Project
          </button>
          <div style="flex: 1"></div>
          <button
            id="deleteProjectBtn"
            class="secondary-btn"
            style="color: #ef4444; border-color: #ef4444"
          >
            Delete Project
          </button>
          <button id="cancelProjectBtn" class="secondary-btn">Cancel</button>
          <button id="saveProjectBtn" class="primary-btn">Save</button>
        </div>
      </div>
    </div>

    <!-- Modifier Help Modal -->
    <div
      id="modifierHelpModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modHelpModalTitle"
    >
      <div class="modal-content" style="width: 400px; max-width: 90vw">
        <h3 id="modHelpModalTitle">About Prompt Modifiers</h3>
        <div
          style="font-size: 0.9em; line-height: 1.5; color: var(--text-main)"
        >
          <p style="margin-bottom: 10px">
            <strong>Modifiers</strong> serve as templates for your prompt
            construction.
          </p>
          <ul style="padding-left: 20px; margin-bottom: 15px">
            <li style="margin-bottom: 5px">
              <strong>Prefixes:</strong> Added to the <em>beginning</em> of your
              prompt (e.g., "High quality," "Masterpiece,").
            </li>
            <li>
              <strong>Suffixes:</strong> Added to the <em>end</em> of your
              prompt (e.g., ", trending on artstation", ", 8k resolution").
            </li>
          </ul>
          <p style="margin-bottom: 10px">
            <strong>Toggling:</strong> You can turn specific modifiers ON or OFF
            for individual cards without deleting them from the project.
          </p>
          <p>
            <strong>Order:</strong> Drag and drop modifiers in the list to
            change the order they appear in the final prompt.
          </p>
        </div>
        <div class="modal-actions">
          <button
            class="primary-btn"
            onclick="
              document
                .getElementById('modifierHelpModal')
                .classList.add('hidden')
            "
          >
            Got it
          </button>
        </div>
      </div>
    </div>

    <!-- Modifier Edit Modal -->
    <div
      id="editModifierModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="editModModalTitle"
      style="z-index: 1100"
    >
      <div class="modal-content" style="width: 500px; max-width: 90vw">
        <h3 id="editModModalTitle">Edit Modifier</h3>
        <input type="hidden" id="editModIndex" />

        <div class="form-group">
          <label for="editModName">Name</label>
          <input
            type="text"
            id="editModName"
            disabled
            style="opacity: 0.7; cursor: not-allowed"
          />
          <div
            style="font-size: 0.75em; color: var(--text-muted); margin-top: 4px"
          >
            Name cannot be changed. Delete and re-create to rename.
          </div>
        </div>

        <div class="form-group">
          <label for="editModContent">Modifier Text (Prompt Segment)</label>
          <textarea
            id="editModContent"
            rows="4"
            placeholder="Enter modifier text..."
            style="font-family: monospace; font-size: 0.9em"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button id="cancelEditModBtn" class="secondary-btn">Cancel</button>
          <button id="saveEditModBtn" class="primary-btn">Save Changes</button>
        </div>
      </div>
    </div>

    <!-- Chat History Modal -->
    <div
      id="chatHistoryModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="chatHistoryTitle"
    >
      <div class="modal-content" style="width: 400px; max-height: 80vh">
        <h3 id="chatHistoryTitle">Chat History</h3>
        <button
          id="chatHistoryCloseX"
          class="modal-close-x"
          title="Close"
          aria-label="Close"
        >
          <span class="material-icons">close</span>
        </button>
        <div id="chatHistoryList" class="chat-history-list-modal">
          <!-- History items injected here -->
        </div>
      </div>
    </div>

    <!-- Image Details Modal -->
    <div
      id="imageModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="imgModalTitle"
    >
      <div class="modal-content modal-content-wide">
        <button
          id="imgModalCloseX"
          class="modal-close-x"
          title="Close"
          aria-label="Close"
        >
          ×
        </button>
        <div class="modal-image-col">
          <img id="imgModalPreview" src="" alt="Preview" />
        </div>

        <div class="modal-info-col">
          <h3 id="imgModalTitle">Details</h3>
          <div class="form-group">
            <label>Filename</label>
            <div id="imgModalName" class="name-field"></div>
          </div>
          <div class="form-group">
            <label>Created</label>
            <div id="imgModalDate" class="date-field"></div>
          </div>
          <div class="form-group prompt-container">
            <div id="imgModalPrompt" class="prompt-text"></div>
          </div>

          <div id="imgModalMetadata" class="img-modal-metadata">
            <div><strong>Model:</strong> <span id="imgModalModel">-</span></div>
            <div><strong>Size:</strong> <span id="imgModalSize">-</span></div>
            <div class="hidden">
              <strong>Creator:</strong> <span id="imgModalCreator">-</span>
            </div>
          </div>

          <!-- Reference Images (if any) -->
          <div id="imgModalRefContainer" class="hidden ref-images-container">
            <div class="ref-images-label">Referenced Images</div>
            <div id="imgModalRefImages" class="ref-images-grid">
              <!-- Thumbnails injected here -->
            </div>
          </div>

          <div class="modal-actions-vertical">
            <div class="modal-actions-row">
              <button
                id="imgModalRegenBtn"
                class="primary-btn hidden"
                title="Regenerate"
              >
                Remake
                <span
                  class="material-icons"
                  style="
                    font-size: 1.2em;
                    vertical-align: middle;
                    margin-left: 4px;
                  "
                  >autorenew</span
                >
              </button>
              <button
                id="imgModalFavoriteBtn"
                class="icon-btn-round"
                title="Toggle Favorite"
                aria-label="Toggle Favorite"
              >
                <span class="material-icons">favorite_border</span>
              </button>
              <button
                id="imgModalStarBtn"
                class="icon-btn-round"
                title="Star Image"
                aria-label="Star Image"
              >
                <span class="material-icons">star_border</span>
              </button>
              <a
                id="imgModalLink"
                href="#"
                target="_blank"
                class="icon-btn-round"
                title="Open File"
                aria-label="Open File"
                style="text-decoration: none"
              >
                <span class="material-icons">folder_open</span>
              </a>
              <button
                id="imgModalArchiveBtn"
                class="icon-btn-round"
                title="Archive Image"
                aria-label="Archive Image"
              >
                <span class="material-icons">delete_outline</span>
              </button>
            </div>
            <button id="imgModalCloseBtn" class="primary-btn">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Help & Shortcuts Modal -->
    <div
      id="helpModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="helpModalTitle"
    >
      <div class="modal-content">
        <h3 id="helpModalTitle">Help & Shortcuts</h3>

        <div class="help-section">
          <h4>Getting Started</h4>
          <ol class="help-steps">
            <li>
              <strong>Add API Key</strong>: Click the '+' next to the API Key
              selector to add your Google Gemini API key.
              <div
                style="
                  font-size: 0.9em;
                  margin-top: 6px;
                  line-height: 1.4;
                  color: var(--text-muted);
                "
              >
                To get a Google Gemini API key, go to
                <a
                  href="https://aistudio.google.com"
                  target="_blank"
                  data-external
                  style="color: var(--primary)"
                  >Google AI Studio</a
                >
                in your browser, sign in with your Google account, and click
                "Get API key" to generate a key.
              </div>
            </li>
            <li>
              <strong>Create Project</strong>: Use the '+' in the sidebar to
              create a new project (e.g., "Tarot Deck").
            </li>
            <li>
              <strong>Create Card</strong>: Click "+ New Card" to define an
              image you want to generate.
            </li>
            <li>
              <strong>Generate</strong>: Enter a prompt and click "Generate
              Art".
            </li>
          </ol>
        </div>

        <div class="help-section">
          <h4>Keyboard Shortcuts</h4>
          <div class="shortcuts-grid">
            <div class="shortcut-item">
              <kbd>/</kbd> <span>Open this menu</span>
            </div>
            <div class="shortcut-item">
              <kbd>Esc</kbd> <span>Close Modals / Cancel Edit</span>
            </div>
            <div class="shortcut-item">
              <kbd>F</kbd> <span>Toggle Favorite (in Gallery)</span>
            </div>
            <div class="shortcut-item">
              <kbd>←</kbd> <kbd>→</kbd> <span>Navigate Gallery</span>
            </div>
            <div class="shortcut-item">
              <kbd>Enter</kbd> <span>Save Card Title</span>
            </div>
          </div>
        </div>

        <div
          class="help-section"
          style="
            margin-top: 20px;
            padding-top: 20px;
            margin-bottom: -77px;
            border-top: var(--glass-border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85em;
          "
        >
          <div>AICardArts v1.1.1</div>
          <div style="margin-top: 8px">
            <a
              href="https://rundquist.tech"
              target="_blank"
              data-external
              style="color: var(--primary); text-decoration: none"
              >Rundquist Tech LLC</a
            >
            <span style="margin: 0 8px; opacity: 0.5">|</span>
            <a
              href="https://github.com/jrundquist/ai-art-cards"
              target="_blank"
              data-external
              style="color: var(--primary); text-decoration: none"
              >GitHub Repository</a
            >
          </div>
        </div>

        <div class="modal-actions">
          <button id="closeHelpBtn" class="primary-btn">Got it</button>
        </div>
      </div>
    </div>
    <!-- Key Modal -->
    <div
      id="keyModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="keyModalTitle"
    >
      <div class="modal-content">
        <h3 id="keyModalTitle">Add API Key</h3>
        <div
          style="
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
            color: var(--text-muted);
          "
        >
          To get a Google Gemini API key, go to
          <a
            href="https://aistudio.google.com"
            target="_blank"
            data-external
            style="color: var(--primary)"
            >Google AI Studio</a
          >
          in your browser, sign in with your Google account, and click "Get API
          key" to generate a key.
        </div>
        <div class="form-group">
          <label for="newKeyName">Key Name</label>
          <input
            type="text"
            id="newKeyName"
            placeholder="e.g. My Gemini Key"
            aria-label="Key Name"
          />
        </div>
        <div class="form-group">
          <label for="newKeyValue">Gemini API Key</label>
          <input
            type="password"
            id="newKeyValue"
            placeholder="AI..."
            aria-label="Gemini API Key"
          />
        </div>

        <div class="modal-actions">
          <button id="cancelKeyBtn" class="secondary-btn">Cancel</button>
          <button id="saveKeyBtn" class="primary-btn">Save</button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div
      id="confirmModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="confirmModalTitle"
    >
      <div class="modal-content">
        <h3 id="confirmModalTitle">Confirm Action</h3>
        <p
          id="confirmModalMessage"
          style="color: var(--text-muted); margin-bottom: 20px"
        >
          Are you sure?
        </p>
        <div class="modal-actions">
          <button id="cancelConfirmBtn" class="secondary-btn">Cancel</button>
          <button
            id="confirmBtn"
            class="primary-btn"
            style="background: #ef4444; border-color: #ef4444"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Regeneration Modal -->
    <div
      id="regenerationModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="regenModalTitle"
      style="z-index: 1200"
    >
      <div class="modal-content" style="width: 500px; max-width: 90vw">
        <h3 id="regenModalTitle">Regenerate Image</h3>

        <div class="form-group">
          <label for="regenPrompt">Prompt</label>
          <textarea id="regenPrompt" rows="5"></textarea>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="regenCount">Count</label>
            <input type="number" id="regenCount" value="1" min="1" max="10" />
          </div>
        </div>

        <div id="regenRefsContainer" class="form-group hidden">
          <label>Reference Images (Uncheck to remove)</label>
          <div id="regenRefList" class="regen-ref-list">
            <!-- Checks -->
          </div>
        </div>

        <div class="modal-actions">
          <button id="cancelRegenBtn" class="secondary-btn cancel-btn">
            Cancel
          </button>
          <button id="confirmRegenBtn" class="primary-btn">
            Generate
            <span class="material-icons" style="margin-left: 5px"
              >auto_awesome</span
            >
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Container (Moved to end of body for z-index) -->
    <div
      id="toast-container"
      class="toast-container"
      role="status"
      aria-live="polite"
    ></div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
